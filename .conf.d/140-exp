# Fabric
alias fabg='fab -g bastion1.sjc'

alias fabgh='fabg -H'
alias fabgp='fabg -P -z 10'
alias fabgph='fabg -P -z 10 -H'

alias fabh='fab -H'
alias fabp='fab -P -z 10'
alias fabph='fab -P -z 10 -H'

alias sshla='ssh -J bastion1.la'
alias sshlv='ssh -J bastion1.lv'
alias sshsc='ssh -J bastion1.sc'
alias sshlax='ssh -J bastion1.lax'
alias sshrno='ssh -J bastion1.rno'
alias sshsjc='ssh -J bastion1.sjc'

function sendkey() {
    deactivate_venv=true

    # Check if virtualenv is activated
    if [[ $PS1 = *"fab!"*  ]]; then
        deactivate_venv=false
    fi

    cd ~/work/Ops-Configs/saltfab/
    source venv/bin/activate

    fab -g bastion1.sjc -H $1 bedrock.sendAuthKey

    # Deactivate virtualenv if it wasn't previously activated
    if [[ "$deactivate_venv" = true ]]; then
        deactivate
    fi

    cd -
}

function fabmeup() {
    cd ~/work/ops/saltfab/
    source venv/bin/activate
}

export -f sendkey
export -f fabmeup
